CPPFLAGS=-DLUA_COMPAT_ALL
CC=i686-pc-mingw32-gcc
CXX=i686-pc-mingw32-g++
STRIP=i686-pc-mingw32-strip
#to compile on windows you must compile fltk
#I compiled fltk in a folder named fltk-1.3.2 which is in the Retro Graphics tookit directory
#if that is not the case for you edit the makefile changing paths
CFLAGS=-Ifltk-1.3.2/ -Ikens/ -Ifltk-1.3.2/zlib -I fltk-1.3.2/png -c -Wall -O2 -s -ffunction-sections -fdata-sections -mwindows -fomit-frame-pointer -pipe -Wl,--gc-sections
CXXFLAGS=$(CFLAGS) -std=gnu++11 -fno-rtti -std=gnu++11
LDFLAGS= -O2 -s -fomit-frame-pointer -Wl,--as-needed -Wl,--gc-sections
LUAOBJECTS=lua/lapi.o lua/lcode.o lua/lctype.o lua/ldebug.o lua/ldo.o lua/ldump.o lua/lfunc.o lua/lgc.o lua/llex.o lua/lmem.o lua/lobject.o lua/lopcodes.o lua/lparser.o lua/lstate.o lua/lstring.o lua/ltable.o lua/ltm.o lua/lundump.o lua/lvm.o lua/lzio.o lua/lauxlib.o lua/lbaselib.o lua/lbitlib.o lua/lcorolib.o lua/ldblib.o lua/liolib.o lua/lmathlib.o lua/loslib.o lua/lstrlib.o lua/ltablib.o lua/loadlib.o lua/linit.o
OBJECTS=$(LUAOBJECTS) project.o main.o callbacks_palette.o callback_tiles.o class_global.o global.o quant.o tilemap.o color_convert.o \
	errorMsg.o class_palette.o dither.o \
	class_tiles.o kens/nemesis.o kens/enigma.o kens/kosinski.o spatial_color_quant.o NEUQUANT.o \
	classtilemap.o palette.o zlibwrapper.o color_compare.o windowinit.o tiles_io.o savepng.o \
	callback_project.o callback_tilemap.o callback_gui.o classChunks.o compressionWrapper.o callback_chunk.o gui.o \
	wu.o system.o filemisc.o classSprite.o classSprites.o callbacksprites.o undo.o undocallback.o image.o \
	classlevel.o runlua.o
LINKER=-Lfltk-1.3.2/lib -s -static-libgcc -static-libstdc++ -lfltk_images -lfltk -lfltk_jpeg -lfltk_png -lfltk_z -mwindows -lole32 -luuid -lcomctl32
EXECUTABLE=RetroGraphicsToolkit.exe

all: $(EXECUTABLE)

$(EXECUTABLE): $(OBJECTS)
	$(CXX) $(LDFLAGS) $(OBJECTS) $(LINKER) -o $@
	$(STRIP) $(EXECUTABLE)
.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) $< -o $@
.cc.o:
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $< -o $@
.cpp.o:
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $< -o $@
clean:
	rm $(OBJECTS) $(EXECUTABLE)
